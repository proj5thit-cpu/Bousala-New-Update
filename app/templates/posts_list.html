{% extends "base.html" %}
{% block content %}

<!-- Background wrapper -->
<section class="py-5" style="background: linear-gradient(135deg, #fff3e0, #ffe0b2, #ffcc80); min-height: 100vh;">
  <div class="container" style="max-width: 950px;">

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="fw-bold text-dark mb-1">
          {% if lang == 'en' %}Community Stories{% else %}ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹{% endif %}
        </h2>
        <p class="text-muted small mb-0">
          {% if lang == 'en' %}
            Explore real experiences shared by others about misinformation and its impact.
          {% else %}
            Ø§Ø³ØªÙƒØ´Ù ØªØ¬Ø§Ø±Ø¨ Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø´Ø§Ø±ÙƒÙ‡Ø§ Ø§Ù„Ø¢Ø®Ø±ÙˆÙ† Ø­ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¶Ù„Ù„Ø© ÙˆØªØ£Ø«ÙŠØ±Ù‡Ø§.
          {% endif %}
        </p>
      </div>
      <a class="btn btn-gradient px-4 rounded-pill shadow-sm"
         href="{{ url_for('main.post', lang=lang) if session.get('user_id') else url_for('main.login', lang=lang) }}">
        <i class="bi bi-plus-circle me-2"></i>
        {% if lang == 'en' %}Share a Story{% else %}Ø´Ø§Ø±Ùƒ ØªØ¬Ø±Ø¨ØªÙƒ{% endif %}
      </a>
    </div>

  <!-- Filter Section -->
<div class="card shadow-sm border-0 rounded-4 mb-4 p-3" style="background: #fffaf2;">
  <div class="d-flex flex-wrap align-items-center justify-content-between mb-2">
    <div class="text-muted small">
      {% if lang == 'en' %}
        <i class="bi bi-funnel-fill me-1 text-primary"></i> Filter options below help you explore posts
      {% else %}
        <i class="bi bi-funnel-fill me-1 text-primary"></i> Ø§Ø³ØªØ®Ø¯Ù… Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØµÙÙŠØ© Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
      {% endif %}
    </div>
  </div>

  <div class="d-flex flex-wrap gap-2 position-relative">
    <!-- Filter by Type -->
    <div class="dropdown">
      <button class="btn btn-outline-primary rounded-pill px-3 dropdown-toggle interactive-btn"
              type="button" data-bs-toggle="dropdown">
        <i class="bi bi-tags-fill me-1"></i>
        {{ type_value if type_value else ( 'Type' if lang == 'en' else 'Ø§Ù„Ù†ÙˆØ¹' ) }}
      </button>
      <ul class="dropdown-menu shadow-sm">
        {% for t in posts|map(attribute='misinfo_type')|unique %}
          <li>
            <a class="dropdown-item" href="?type={{ t }}{% if danger_value %}&danger={{ danger_value }}{% endif %}{% if state_value %}&state={{ state_value }}{% endif %}{% if time_value %}&time={{ time_value }}{% endif %}{% if owner_value %}&owner={{ owner_value }}{% endif %}">
              {{ t }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Filter by Danger -->
    <div class="dropdown">
      <button class="btn btn-outline-danger rounded-pill px-3 dropdown-toggle interactive-btn"
              type="button" data-bs-toggle="dropdown">
        <i class="bi bi-exclamation-triangle-fill me-1"></i>
        {{ danger_value if danger_value else ( 'Danger' if lang == 'en' else 'Ø§Ù„Ø®Ø·ÙˆØ±Ø©' ) }}
      </button>
      <ul class="dropdown-menu shadow-sm">
        {% for d in posts|map(attribute='danger_level')|unique %}
          <li>
            <a class="dropdown-item" href="?danger={{ d }}{% if type_value %}&type={{ type_value }}{% endif %}{% if state_value %}&state={{ state_value }}{% endif %}{% if time_value %}&time={{ time_value }}{% endif %}{% if owner_value %}&owner={{ owner_value }}{% endif %}">
              {{ d }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Filter by State -->
    <div class="dropdown">
      <button class="btn btn-outline-success rounded-pill px-3 dropdown-toggle interactive-btn"
              type="button" data-bs-toggle="dropdown">
        <i class="bi bi-geo-alt-fill me-1"></i>
        {{ state_value if state_value else ( 'State' if lang == 'en' else 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ©' ) }}
      </button>
      <ul class="dropdown-menu shadow-sm">
        {% for s in posts|map(attribute='state')|unique %}
          <li>
            <a class="dropdown-item" href="?state={{ s }}{% if type_value %}&type={{ type_value }}{% endif %}{% if danger_value %}&danger={{ danger_value }}{% endif %}{% if time_value %}&time={{ time_value }}{% endif %}{% if owner_value %}&owner={{ owner_value }}{% endif %}">
              {{ s }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Filter by Time -->
    <div class="dropdown">
      <button class="btn btn-outline-info rounded-pill px-3 dropdown-toggle interactive-btn"
              type="button" data-bs-toggle="dropdown">
        <i class="bi bi-calendar-event-fill me-1"></i>
        {{ time_value if time_value else ( 'Time' if lang == 'en' else 'Ø§Ù„ÙˆÙ‚Øª' ) }}
      </button>
      <ul class="dropdown-menu shadow-sm">
        {% for t in posts|map(attribute='time')|unique %}
          {% if t %}
            <li>
              <a class="dropdown-item" href="?time={{ t }}{% if type_value %}&type={{ type_value }}{% endif %}{% if danger_value %}&danger={{ danger_value }}{% endif %}{% if state_value %}&state={{ state_value }}{% endif %}{% if owner_value %}&owner={{ owner_value }}{% endif %}">
                {{ t }}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>

    <!-- My Posts -->
    <a class="btn btn-outline-dark rounded-pill px-3 interactive-btn"
       href="?owner=me{% if type_value %}&type={{ type_value }}{% endif %}{% if danger_value %}&danger={{ danger_value }}{% endif %}{% if state_value %}&state={{ state_value }}{% endif %}{% if time_value %}&time={{ time_value }}{% endif %}">
      <i class="bi bi-person-circle me-1"></i>
      {% if lang == 'en' %}My Posts{% else %}Ù…Ù†Ø´ÙˆØ±Ø§ØªÙŠ{% endif %}
    </a>

    <!-- Clear -->
    <a class="btn btn-outline-secondary rounded-pill px-3 interactive-btn"
       href="{{ url_for('main.posts_list', lang=lang) }}">
      <i class="bi bi-x-circle me-1"></i>
      {% if lang == 'en' %}Clear{% else %}Ø¥Ù„ØºØ§Ø¡{% endif %}
    </a>
  </div>
</div>

    <!-- Empty State -->
    {% if not posts %}
      <div class="card border-0 shadow-sm rounded-4 text-center p-5 bg-white">
        <i class="bi bi-chat-dots text-secondary fs-1 mb-3"></i>
        <p class="text-muted fs-5 mb-3">
          {% if lang == 'en' %}No stories yet.{% else %}Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ØµØµ Ø­Ø§Ù„ÙŠØ§Ù‹.{% endif %}
        </p>
        <a class="btn btn-gradient px-4 rounded-pill shadow-sm"
           href="{{ url_for('main.post', lang=lang) if session.get('user_id') else url_for('main.login', lang=lang) }}">
          {% if lang == 'en' %}Be the first to share{% else %}ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ{% endif %}
        </a>
      </div>
    {% endif %}

    <!-- Post Cards -->
    {% for post in posts %}
      <div class="card shadow-sm mb-4 border-0 rounded-4 post-card"
           style="background: #fff; transition: all 0.3s;">
        <div class="card-body p-4" style="background-color: #fffaf5;">
          <!-- Title -->
          <h4 class="fw-bold text-primary mb-3">
            {{ post.misinfo_type }}
            {% if post.followup %}
              <span class="text-dark fw-normal">â€“ {{ post.followup }}</span>
            {% endif %}
          </h4>

          <!-- Meta Info -->
          <div class="d-flex flex-wrap align-items-center small text-muted mb-3 gap-3">
            <span><i class="bi bi-geo-alt-fill text-danger me-1"></i>{{ post.state }}{% if post.locality %} â€“ {{ post.locality }}{% endif %}</span>
            <span><i class="bi bi-exclamation-triangle-fill me-1 {% if post.danger_level == 'High' %}text-danger{% elif post.danger_level == 'Medium' %}text-warning{% else %}text-success{% endif %}"></i>{{ post.danger_level }}</span>
            <span><i class="bi bi-calendar-event text-primary me-1"></i>{{ post.time }}</span>
          </div>

          <!-- Content -->
          <p class="text-dark fs-6 mb-4" style="line-height: 1.7;">{{ post.content }}</p>

          <!-- Media -->
          {% if post.media_items %}
            <div class="row g-3">
              {% for m in post.media_items %}
                {% if m.media_type == 'image' %}
                  <div class="col-6 col-md-4">
                    <img src="{{ url_for('main.uploaded_file', filename=m.filename) }}"
                         alt="post image"
                         class="img-fluid rounded shadow-sm border hover-zoom">
                  </div>
                {% elif m.media_type == 'audio' %}
                  <div class="col-12">
                    <audio controls class="w-100 rounded shadow-sm">
                      <source src="{{ url_for('main.uploaded_file', filename=m.filename) }}" type="audio/mpeg">
                    </audio>
                  </div>
                {% elif m.media_type == 'video' %}
                  <div class="col-12">
                    <video controls class="w-100 rounded shadow-sm border">
                      <source src="{{ url_for('main.uploaded_file', filename=m.filename) }}" type="video/mp4">
                    </video>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}

          <!-- Date -->
          <div class="mt-3 text-muted small">
            <i class="bi bi-clock text-secondary me-1"></i>
            {{ post.created_at.strftime('%b %d, %Y %H:%M') if post.created_at }}
          </div>

          <!-- Actions -->
          {% if session.get('user_id') == post.user_id %}
            <div class="mt-3 d-flex gap-2">
              <a href="{{ url_for('main.edit_post', post_id=post.id) }}" class="btn btn-warning btn-sm">âœ Edit</a>
              <form action="{{ url_for('main.delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?');">ğŸ—‘ Delete</button>
              </form>
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}

    <!-- Pagination -->
    {% if total_pages and total_pages > 1 %}
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">
          <!-- Previous -->
          <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
            <a class="page-link" href="?page={{ current_page - 1 }}{% if filter_type %}&filter={{ filter_type }}&value={{ value }}{% endif %}{% if lang %}&lang={{ lang }}{% endif %}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>

          <!-- Numbered pages -->
          {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == current_page %}active{% endif %}">
              <a class="page-link" href="?page={{ p }}{% if filter_type %}&filter={{ filter_type }}&value={{ value }}{% endif %}{% if lang %}&lang={{ lang }}{% endif %}">
                {{ p }}
              </a>
            </li>
          {% endfor %}
          <!-- Next -->
          <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
            <a class="page-link" href="?page={{ current_page + 1 }}{% if filter_type %}&filter={{ filter_type }}&value={{ value }}{% endif %}{% if lang %}&lang={{ lang }}{% endif %}" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>
    {% endif %}
  </div>
</section>
<!-- Styles -->
<style>
.btn-gradient {
  background: linear-gradient(90deg, #d17a22, #f7a84e);
  color: white !important;
  font-weight: 500;
  border: none;
  transition: all 0.3s;
}
.btn-gradient:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

.interactive-btn {
  transition: all 0.3s ease;
  position: relative;
}
.interactive-btn:hover {
  transform: none;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}
.interactive-btn:hover::after {
  
  position: absolute;
  bottom: -22px;
  left: 50%;
  transform: translateX(-50%);
  
  color: #fff;
  padding: 3px 6px;
  font-size: 11px;
  border-radius: 4px;
}

.post-card {
  animation: fadeInUp 0.6s ease;
}
@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.post-card:hover {
  transform: translateY(-5px);
  background-color: #fff3e0;
  box-shadow: 0 8px 18px rgba(0,0,0,0.25) !important;
}

.hover-zoom {
  transition: transform 0.3s ease;
}
.hover-zoom:hover {
  transform: scale(1.05);
}

.pagination .page-link {
  background: #fffaf2;
  color: #d17a22;
  border-radius: 12px;
  border: 1px solid #f1d3a0;
  margin: 0 4px;
  width: 38px;
  height: 38px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.3s ease;
}
.pagination .page-link:hover {
  background: linear-gradient(90deg, #d17a22, #f7a84e);
  color: #fff;
}
.pagination .page-item.active .page-link {
  background: linear-gradient(90deg, #d17a22, #f7a84e);
  color: #fff;
  font-weight: bold;
}
</style>

{% endblock %}
